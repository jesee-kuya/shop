<% content_for :body_class, "cart-index" %>

<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8">
        <h1 class="title">Shopping Cart</h1>
        
        <% if @cart_items.any? %>
          <% @cart_items.each do |item| %>
            <div class="box">
              <div class="columns is-vcentered">
                <div class="column is-2">
                  <% if item.product.image.present? %>
                    <%= image_tag(item.product.image_url(:thumb), class: "image is-96x96") %>
                  <% end %>
                </div>
                
                <div class="column is-4">
                  <h4 class="title is-5"><%= item.product.title %></h4>
                  <p class="subtitle is-6"><%= item.product.brand %> - <%= item.product.model %></p>
                </div>
                
                <div class="column is-2">
                  <%= form_with model: item, url: cart_item_path(item), method: :patch, local: true, class: "quantity-form" do |f| %>
                    <div class="field has-addons">
                      <%= f.number_field :quantity, value: item.quantity, min: 1, class: "input is-small" %>
                      <%= f.submit "Update", class: "button is-small is-primary" %>
                    </div>
                  <% end %>
                </div>
                
                <div class="column is-2">
                  <p class="title is-6"><%= number_to_currency(item.total_price) %></p>
                </div>
                
                <div class="column is-2">
                  <%= link_to "Remove", cart_item_path(item), method: :delete, 
                      data: { confirm: "Are you sure?" }, 
                      class: "button is-small is-danger" %>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="has-text-centered">
            <p class="title is-4">Your cart is empty</p>
            <%= link_to "Continue Shopping", products_path, class: "button is-primary" %>
          </div>
        <% end %>
      </div>
      
      <% if @cart_items.any? %>
        <div class="column is-4">
          <div class="box">
            <h3 class="title is-4">Order Summary</h3>
            <div class="content">
              <p><strong>Total Items:</strong> <%= @cart.total_items %></p>
              <p><strong>Total Price:</strong> <%= number_to_currency(@cart.total_price) %></p>
            </div>
            <hr>
            <%= link_to "Proceed to Checkout", "#", class: "button is-success is-fullwidth" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</section>
